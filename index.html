<!DOCTYPE html>
<html>
  <head>

    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <link rel="stylesheet" href="index.css">
    <script>

      /*
      Show the user new tweets somehow. (You can show them automatically as they're created, or create a button that displays new tweets.)
      
      Display the timestamps of when the tweets were created. This timestamp should reflect the actual time the tweets were created, and should not just be hardcoded.
      
      Design your interface so that you want to look at and use the product you're making.
      
      Allow the user to click on a username to see that user's timeline.
      */

      $(document).ready(function(){
        var $ul = $('ul');
        var renderAllTweets = function(){
          $ul.html('<ul><ul>'); 
          
          for(var index = streams.home.length - 1; index >= 0; index--){
            var tweet = streams.home[index];
            var $tweet = $('<li></li>');
            var $name = $('<span class="userName" id="' + tweet.user + '">' + tweet.user +' </span>');
            $name.click({user: tweet.user}, renderUserTimeLine);
            $tweet.append('@');
            $tweet.append($name);
            $tweet.append(
                            '(' +timeSince(tweet.created_at) + ' ago) ' +
                            tweet.message +' | ' +
                            getFormattedDate(tweet.created_at)
                          );
            
            $tweet.appendTo($ul);
            //Set clickListener to user names
            //$('#'+tweet.user+).click({user: tweet.user}, renderUserTimeLine);
          }
        }
        renderAllTweets();
        $('#newTweetsButton').click( renderAllTweets);

        function renderUserTimeLine(event){
          var user = event.data.user;
          $ul.html('<ul><ul>'); 
          //Getting array of tweets by this user
          var tweetsByUser = streams.users[user];

          //Populated the tweets as <li> elements in our <ul> 
          for(var i = tweetsByUser.length -1; i >= 0; i--){
            var tweet = tweetsByUser[i];
            //initialize with <li> element
            var $tweet = $('<li></li>');
            //Insert tweet as a text
            $tweet.text('@' + tweet.user + ': ' + tweet.message +' | ' +getFormattedDate(tweet.created_at));
            //append this tweet <li> to our <ul>
                  $tweet.appendTo($ul);
          }
        }

      });

      function getFormattedDate(date){
        var year = date.getFullYear();
        var month = (1 + date.getMonth()).toString();
        month = month.length > 1 ? month : '0' + month;

        var day = date.getDate().toString();
        day = day.length > 1 ? day : '0' + day;

        var hour = date.getHours();
        var minute = date.getMinutes();
        var second = date.getSeconds();
  
        return '(' + hour + ' : ' + minute + ' : ' + second + ') '+ month + '/' + day + '/' + year;
      }

      function timeSince(date) {

        var seconds = Math.floor((new Date() - date) / 1000);

        var interval = Math.floor(seconds / 31536000);

        if (interval > 1) {
          return interval + " years";
        }
        interval = Math.floor(seconds / 2592000);
        if (interval > 1) {
          return interval + " months";
        }
        interval = Math.floor(seconds / 86400);
        if (interval > 1) {
          return interval + "d";
        }
        interval = Math.floor(seconds / 3600);
        if (interval > 1) {
          return interval + "hr";
        }
        interval = Math.floor(seconds / 60);
        if (interval > 1) {
          return interval + "min";
        }
        return Math.floor(seconds) + "s";
      }
    </script>
  </head>
  <body>
    <h1>Twittler Application<h1>
    <button id="newTweetsButton">Feed New Tweets</button>
    <ul></ul>
  </body>
</html>


